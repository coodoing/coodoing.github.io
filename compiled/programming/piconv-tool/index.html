<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>piconv tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="x z">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
<link href='/assets/stylesheets/bootstrap.min-88238289010db19359d2181e634e95cd.css' type='text/css' rel='stylesheet' media='all'>
<link href='/assets/stylesheets/style-5e4377b21af72b44e01f5351e53fbf33.css' type='text/css' rel='stylesheet' media='all'>
<link href='/assets/stylesheets/rye-4031a0473efc047582557f054f66b459.css' type='text/css' rel='stylesheet' media='all'>
<link href='/assets/stylesheets/google_prettify/sons-of-obsidian-afb0925bfa2d994f17dab93e13fbf999.css' type='text/css' rel='stylesheet' media='all'>
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">Rye of coodoing</a>
          <ul class="nav">
              
                <li><a href="/archive">Archive</a></li>
              
              
                <li><a href="/tags">Tags</a></li>
              
              
                <li><a href="/categories">Categories</a></li>
              
              
                <li><a href="/pages">Pages</a></li>
              
              
                <li><a href="/about">About</a></li>
              
          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h1>piconv tool </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>2014-05-12</strong>
    </div>
    <div class="content">
      <h2 id="toc_0">Description</h2>

<p>The <code>piconv</code> tool use <code>chardet</code> to auto detect the file&#39;s encoding format and convert it to the specified encoding format even you don&#39;t know what the file&#39;s encoding is. If you want to know more about <code>chardet</code>, you can checkout the <code>uchardet</code>.  </p>

<h2 id="toc_1">How to use the <code>piconv</code> tool</h2>

<p>The <code>piconv</code> tool provides an easy way to convert the file&#39;s encoding, you just need to input <code>&#39;file_name&#39;</code> and <code>&#39;to_encoding&#39;</code> params to realizing the convertion process.</p>

<p>Run the <strong><em>piconv.py</em></strong> script as following:</p>

<pre><code>python piconv.py filename/dirname to_encoding
</code></pre>

<h2 id="toc_2">Why piconv?</h2>

<p>When you encounter some garbled characters problem, you must want to convert it to the correct encoding, linux provides <code>iconv</code> command to convert file between different character encodings. The from-encoding and to-encoding params must be specified and even though it may still generate some garbled characters like <strong>&#39;?? ����2?����&#39;</strong>. </p>

<p><strong><em>If you know the file&#39;s correct encoding(includes from and to encodings), just ignore what I descibe  below</em></strong>. But when you don&#39;t get the file&#39;s right encoding or you don&#39;t even know the file&#39;s encoding, you can&#39;t convert the file correctly. </p>

<p>I develop <code>piconv</code> tool to solve the encoding problem and simplify this convertion process of many files in the input directory. When you use the <code>piconv</code> tool, you just need to input the &#39;file/dir&#39; and &#39;to-encoding&#39; param to realize the right convertion. For more usage detail, just checkout the <strong>How to use <code>piconv</code> section</strong>.</p>

<p>At first, I will show you some test cases about some garbled characters problem during using <code>iconv</code> command. Then I will compare the usage beetween  <code>iconv</code> and <code>piconv</code>.</p>

<h3 id="toc_3"><code>iconv</code> garbled characters problem</h3>

<p>The encoding format of <strong>data-set/chinese-ansi.txt</strong> is <em>GBK</em>, but you will get <em>ISO-8859</em> when use the <code>file</code> command, then the format will be wrong. So if you don&#39;t know the right encoding of the file and use the <em>ISO-8859-1</em> encoding, the convertion will be wrong and cause some encoding problems.  </p>

<pre><code>file data-set/chinese-ansi.txt #ISO-8859
iconv -f iso-8859-1 -t utf-8 data-set/chinese-ansi.txt &gt; chinese-ansi.txt # garbled character-����

Or

iconv -f GBK -t utf-8 data-set/chinese-ansi.txt &gt; chinese-ansi.txt # correctly

</code></pre>

<p>The input file <strong>data-set/assoc.c</strong> contains chinese characters <strong>&quot;ͷ�巨&quot;</strong> and is <em>utf-8</em> encoding format. The source content is:</p>

<pre><code>    // ͷ�巨
    return 1;
}
</code></pre>

<ul>
<li><strong>convert utf-8 to gbk</strong></li>
</ul>

<pre><code>iconv -f utf-8 -t gbk data-set/assoc.c &gt; utf8-gbk.c
#piconv -f utf-8 -t gbk data-set/assoc.c &gt; utf8-gbk-p.c
</code></pre>

<pre><code>  // ����2?����
     return 1;
  }
</code></pre>

<ul>
<li><strong>convert gbk to utf-8</strong> </li>
</ul>

<p>Now we take a look at the result when convert gbk to utf-8 through <code>iconv</code>.</p>

<pre><code> iconv -f gbk -t utf-8 data-set/assoc.c &gt; gbk-utf8.c
 #iconv: illegal input sequence at position 16
</code></pre>

<p>(<strong>terminated by the unicode error</strong>)</p>

<pre><code>    // 头插��
</code></pre>

<p>Then we use <strong><code>iconv -c</code></strong> option to omit invalid characters from output.</p>

<pre><code>iconv -c -s -f gbk -t utf-8 data-set/assoc.c &gt; gbk-utf8-c.c
</code></pre>

<pre><code>    // 头插��
    return 1;
}
</code></pre>

<ul>
<li><strong>utf8 to utf8 &amp; gbk to gbk</strong></li>
</ul>

<pre><code>iconv -c -s -f utf-8 -t utf-8 data-set/assoc.c &gt; utf8-utf8.c

iconv -c -s -f gbk -t gbk data-set/assoc.c &gt; gbk-gbk.c
</code></pre>

<pre><code>     // ͷ�巨
    return 1;
}

    // ?����?&lt;8f&gt;&lt;92&gt;?3
    return 1;
}

</code></pre>

<p>You can also test other convertion cases. </p>

<h3 id="toc_4">Usage comparision between <code>piconv</code> and <code>iconv</code></h3>

<ul>
<li><strong>Use <code>iconv</code> to convert input file and directory</strong>
use the <code>exec</code>  or <code>bash</code> to iterator directories</li>
</ul>

<pre><code>iconv -c -s -f gbk -t utf-8 data-set/assoc.c &gt; gbk-utf8-c.c

find iconv-test/ -name gbk-gbk.c -exec iconv -c -f gbk 
-t utf-8 &quot;{}&quot; -o &quot;{}&quot; \;
find iconv-test/ -name gbk-gbk.c -type f | (while read file; do  iconv -c -f gbk -t utf-8 &quot;$file&quot; &gt;&quot;${file%.txt}-utf8.txt&quot;; done);
</code></pre>

<ul>
<li><strong>How we do through <code>piconv</code> tool</strong></li>
</ul>

<pre><code>FIconv(&#39;Filename&#39;,to-encoding)
#FIconv(&#39;french-mscs.txt&#39;,&#39;utf-8&#39;)

DIconv(&#39;Dirname&#39;,to-encoding).codecs_iconv_iterator()
#diconv = DIconv(&#39;/var/www/piconv/test&#39;,&#39;utf-8&#39;)
#diconv.codecs_iconv_iterator()
</code></pre>

<h2 id="toc_5">Supports Encodings</h2>

<p>As using <code>chardet</code> to detect the file&#39;s encoding, <code>piconv</code> supports the follow encodings:</p>

<blockquote>
<ul>
<li>ASCII, UTF-8, UTF-16 (2 variants), UTF-32 (4 variants)</li>
<li>Big5, GB2312, EUC-TW, HZ-GB-2312, ISO-2022-CN (Traditional and Simplified Chinese)</li>
<li>EUC-JP, SHIFT_JIS, ISO-2022-JP (Japanese)</li>
<li>EUC-KR, ISO-2022-KR (Korean)</li>
<li>KOI8-R, MacCyrillic, IBM855, IBM866, ISO-8859-5, windows-1251 (Cyrillic)</li>
<li>ISO-8859-2, windows-1250 (Hungarian)</li>
<li>ISO-8859-5, windows-1251 (Bulgarian)</li>
<li>windows-1252 (English)
*ISO-8859-7, windows-1253 (Greek)</li>
<li>ISO-8859-8, windows-1255 (Visual and Logical Hebrew)</li>
<li>TIS-620 (Thai)</li>
</ul>
</blockquote>

<h2 id="toc_6">Functions &amp; Advantages</h2>

<p>The <code>piconv</code> includes following functions and advantages:</p>

<blockquote>
<ul>
<li>auto-detect files&#39; encoding</li>
<li>encoding exception handler</li>
<li>simplify the convertion of <code>iconv</code> and easy to use</li>
</ul>
</blockquote>

<p><strong>todo</strong></p>

<blockquote>
<ul>
<li>regex match convertion</li>
<li>compress the dirname and improve the iteration speed</li>
</ul>
</blockquote>

<h2 id="toc_7">References</h2>

<ul>
<li><a href="https://github.com/chardet/chardet">chardet</a></li>
<li><a href="http://lxr.mozilla.org/seamonkey/source/extensions/universalchardet/">mozilla chardet</a></li>
</ul>

    </div>
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      <li>
        <a href="/categories#Programming-ref">Programming <span>2</span></a>
      </li>
    </ul>
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      <li>
        <a href="/tags#python-ref">python <span>2</span></a>
      </li>
      <li>
        <a href="/tags#iconv-ref">iconv <span>1</span></a>
      </li>
    </ul>
    <hr>
    <div class="pagination">
      <ul>
          <li class="prev"><a href="/programming/python-unicode" title="python unicode">&larr; Previous</a></li>

          <li><a href="/archive">Archive</a></li>

          <li class="next"><a href="/opensource/hybridauth%E4%B8%BB%E8%A6%81%E7%B1%BB%E5%88%86%E6%9E%90" title="Hybridauth主要类分析">Next &rarr;</a></li>
      </ul>
    </div>
    <hr>
    
  </div>
</div>


      </div>

      <hr>
      <!--
      <div class="footer">
        <p>&copy; x z 2013
          with help from <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </div>
      -->
    </div> <!-- /container -->

    <!-- Google Prettify -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>
<!-- end Google Prettify -->
    
    
  </body>
</html>
